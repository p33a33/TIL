# Today I leanred(21.01.07)
<br>

## React native 프로젝트 테스트

### 인증 방식 수정 

1. 인증 테스트 실패
로컬 환경에서 잘 유지되던 `session`이 서버가 `EC2`로 넘어가면서 유지가 안됐다. 로그인은 잘 넘어갔으나, 로그인 이후 다른 스크린으로 페이지가 넘어가면서 새로운 새션으로 갱신되었다. 인증 받은 세션이 인증되지 않은 새로운 새션으로 갱신되면서 발생하는 문제였다.

2. 문제 원인 해결
    
    1. 기존에 구현된 인증은 `Passport.js`를 사용한 세션기반의 인증이다. 로컬환경에서는 세션이 갱신되지않고 잘 유지가 되었기때문에 테스트를 하거나, 실행함에는 무리가 없었으나 이번에 처음으로  remote server에 접속해보면서 현재 인증에 문제가 있다고 인식하게 됐다.

    2. `Passport.js`는 우리팀이 직전 프로젝트에서 사용해보면서 그 사용방법이 익숙하고, 수 많은 `Oauth Strategy`를 제공하며 구현도 간편했기 때문에 사용했으나 모바일 어플리케이션과 fit이 좋지 않다고 느꼈다. 그래도 편하게 인증을 구현할 수 있으므로 좀 억지로 끼워맞춘 감이 없지않아 있다.

    3. `Local`과 `Remote server`사이에 무슨 차이가 있는지 몰라도, 빌드된 어플리케이션을 `Local`하고만 통신하게할 수 없기때문에 기존 인증로직을 뒤집어 엎어야했다.

    4. 기존 `Passport.js`로직을 뒤로하고 `JWT(Json Web Token)`방식의 인증을 구현하기로 했다.

    5. 기본적인 로직은 클라이언트에서 보낸 `email`과 `password`를 가지고 DB를 검색하여, 해당 유저가 있으면 유저의 정보를 담은 `JWT`를 발행(암호화된 값) 로그인 요청에 응답으로 전달한다.

    6. 클라이언트는 서버로부터 전달받은 `JWT`를 로컬 스토리지나 cookie에 저장하고, 매 요청마다 request header에 담아 전달한다. 

    7. 요청을 받는 서버는 매번 JWT를 통해 유저를 식별하고, 유효한 유저인 경우 요청을 처리하여 응답한다.

    8. 나의 경우 해당 프로젝트 빌드 파일을 전달해야하는 상황이었기 때문에 중복 로그인과 같은 예외에 대한 처리가 부족했으나, 추후 JWT를 통한 인증 구현 시 반드시 보안과 예외사항에 더 신경을 써야할 것이다.







